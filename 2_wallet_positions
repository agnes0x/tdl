import pandas
import numpy
import requests
import datetime
import time

#######################################
# 2. get wallet positions
#######################################


# Set wallet address
address= '0xE831C8903de820137c13681E78A5780afDdf7697'

# Etherscan api url
url1 = 'https://api.etherscan.io/api?module=account&action=tokentx&address='

url2 = "&page=1&offset=1000&startblock=0&endblock=27025780&sort=asc&apikey="

api_key = 'R2SSSRDSPZN3HWMHITBIQUM3EKQE2YED9I'

query = url1 + address + url2 + api_key 

# Get data
response2 = requests.get(query).json()
df = pandas.json_normalize(response2['result'])

# set filter data

# get list of tokens historically interacted with
filterlist_symbol = list(set(df['tokenSymbol']))

# determine if lender or borrower

lender = False

borrower = False

filterlist_name = list(set(df['tokenName']))


for item in filterlist_name:
    if 'Aave interest bearing ' in item:
        lender = True
        break  # Stop searching once a match is found

for item in filterlist_name:
    if 'Aave variable debt bearing ' in item:
        borrower = True
        break  # Stop searching once a match is found        
        





